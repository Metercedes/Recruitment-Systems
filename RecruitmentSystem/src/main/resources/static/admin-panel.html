<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        .admin-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .user-item {
            padding: 10px;
            margin: 5px 0;
            background: #f5f5f5;
            border-radius: 3px;
        }
        .danger-button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            margin: 0 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        .danger-button:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body onload="checkAuth(); loadAdminData();">
<h2>Admin Panel</h2>
<nav>
    <a href="/index.html">Home</a>
    <a href="/add-job.html">Add Job</a>
    <a href="/view-jobs.html">View Jobs</a>
    <a href="/settings.html">Settings</a>
</nav>

<div class="admin-section">
    <h3>User Management</h3>
    <div id="usersList"></div>
</div>

<div class="admin-section">
    <h3>System Status</h3>
    <div id="systemStatus"></div>
</div>

<script src="/js/auth-check.js"></script>
<script src="/js/scripts.js"></script>
<script>
function loadAdminData() {
    if (!currentUser || !currentUser.isAdmin) {
        document.body.innerHTML = '<h2>Admin access required</h2><a href="/index.html">Back to Home</a>';
        return;
    }
    
    // Load users
    fetch('/api/debug/users', {
        headers: { 'X-Username': currentUser.username }
    })
    .then(response => response.json())
    .then(users => {
        const usersList = document.getElementById('usersList');
        usersList.innerHTML = '';
        
        if (users.error) {
            usersList.innerHTML = '<p>Error loading users: ' + users.error + '</p>';
            return;
        }
        
        Object.values(users).forEach(user => {
            const userDiv = document.createElement('div');
            userDiv.className = 'user-item';
            userDiv.innerHTML = `
                <strong>${user.username}</strong> - ${user.userType} ${user.admin ? '(Admin)' : ''}
                <br>Locked: ${user.wasLocked ? 'Yes' : 'No'}
                <br>
                <button class="danger-button" onclick="banUser('${user.username}')" ${user.admin ? 'disabled' : ''}>
                    Ban User
                </button>
                <button class="danger-button" onclick="deleteUser('${user.username}')" ${user.admin ? 'disabled' : ''}>
                    Delete User
                </button>
            `;
            usersList.appendChild(userDiv);
        });
    })
    .catch(error => {
        console.error('Error loading users:', error);
        document.getElementById('usersList').innerHTML = '<p>Error loading users</p>';
    });
}

function banUser(username) {
    if (!confirm(`Are you sure you want to ban user: ${username}?`)) {
        return;
    }
    
    fetch(`/api/admin/users/${username}/ban`, {
        method: 'POST',
        headers: { 'X-Username': currentUser.username }
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
        if (data.success) {
            loadAdminData();
        }
    })
    .catch(error => {
        console.error('Error banning user:', error);
        alert('Error banning user');
    });
}

function deleteUser(username) {
    if (!confirm(`Are you sure you want to DELETE user: ${username}? This action cannot be undone!`)) {
        return;
    }
    
    fetch(`/api/admin/users/${username}`, {
        method: 'DELETE',
        headers: { 'X-Username': currentUser.username }
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
        if (data.success) {
            loadAdminData();
        }
    })
    .catch(error => {
        console.error('Error deleting user:', error);
        alert('Error deleting user');
    });
}
</script>
</body>
</html>